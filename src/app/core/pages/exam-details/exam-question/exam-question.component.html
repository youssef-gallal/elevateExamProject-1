@if (questions$ | async; as questions) {

@if (viewMode === 'questions' && questions?.length) {
<div>
    <div class="d-flex justify-content-between mb-3 top-0">
        <p class="text-blue fs-4">Question {{ currentIndex + 1 }} of {{ questions.length }}</p>
    </div>

    <div class="d-flex gap-4 mb-3">
        @for (q of questions; let i = $index;track q._id) {
        <span class="progress-bullet 
           {{ i === currentIndex ? 'active' : '' }} 
           {{ selectedAnswers[q._id] ? 'answered' : '' }}" (click)="currentIndex = i">
        </span>
        }

    </div>

    <div class="mb-4 p-2 border rounded">
        <h3 class="mb-3">{{ questions[currentIndex].question }}</h3>
        <div class="ms-3">
            @for (ans of questions[currentIndex].answers; track $index) {
            <div class="mb-1">
                <p-radioButton [inputId]="'ans_' + currentIndex + '_' + ans.key" [name]="'question_' + currentIndex"
                    [value]="ans.key" [(ngModel)]="selectedAnswers[questions[currentIndex]._id]">
                </p-radioButton>
                <label [for]="'ans_' + currentIndex + '_' + ans.key" class="ms-2">
                    {{ ans.answer }}
                </label>
            </div>
            }
        </div>
    </div>

    <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-secondary" (click)="prevQuestion()" [disabled]="currentIndex === 0">
            Previous
        </button>

        @if (currentIndex !== questions.length - 1) {
        <button class="btn btn-primary" (click)="nextQuestion(questions.length)"
            [disabled]="!selectedAnswers[questions[currentIndex]._id]">
            Next
        </button>
        }
        @if (currentIndex === questions.length - 1) {
        <button class="btn btn-primary" (click)="submitAnswers(questions)"
            [disabled]="!selectedAnswers[questions[currentIndex]._id]">
            Submit
        </button>
        }
    </div>
</div>
}
}
@if (loading$ | async)
{<div class="flex justify-content-center text-center" style=" height: 200px;">
    <p-progress-spinner ariaLabel=" loading" />
</div>}